<!DOCTYPE html>
<html>

<head>
	<title>Sprite Editor</title>

	<style>
		button {
			width: 50px;
			height: 16px;
			background-color: #007BFF;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 16px;
			margin: 4px !important;
			padding: 0px;
			line-height: 0px;
			display: block;
			text-align: center;
		}

		button:hover {
			background-color: #0056b3;
		}

		table {
			border-collapse: collapse;
			margin: 0px;
			padding: 0px;
			width: 60%;
			text-align: center;
		}

		thead,
		th,
		tr,
		td {
			margin: 0px;
			padding: 0px;
			border: 2px solid #000;
		}

		tr.custom-height {
			height: 100%;
		}

		td {
			width: 50px !important;
			height: 50px !important;
			vertical-align: middle;
		}
	</style>

</head>

<body>

	<table>
		<thead>
			<tr>
				<th colspan="3">Controls</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td></td>
				<td>
					<button onclick="moveImageUp(100.0)">-100</button>
					<button onclick="moveImageUp(10.00)">-10.0</button>
					<button onclick="moveImageUp(1.000)">-1.00</button>
				</td>
				<td></td>
				<td rowspan="8"> <canvas id="spriteEditor"></canvas></td>
			</tr>
			<tr>
				<td>
					<button onclick="moveImageLeft(100.0)">-100</button>
					<button onclick="moveImageLeft(10.00)">-10.0</button>
					<button onclick="moveImageLeft(1.000)">-1.00</button>
				</td>
				<td>Move Image</td>
				<td>
					<button onclick="moveImageRight(100.0)">+100</button>
					<button onclick="moveImageRight(10.00)">+10.0</button>
					<button onclick="moveImageRight(1.000)">+1.00</button>
				</td>
			</tr>
			<tr>
				<td></td>
				<td>
					<button onclick="moveImageDown(100.0)">+100</button>
					<button onclick="moveImageDown(10.00)">+10.0</button>
					<button onclick="moveImageDown(1.000)">+1.00</button>
				</td>
				<td></td>
			</tr>
			<tr>
				<td>
					<button onclick="zoomImageOut(1.00)">1.00</button>
					<button onclick="zoomImageOut(0.10)">0.10</button>
					<button onclick="zoomImageOut(0.01)">0.01</button>
				</td>
				<td>Image Zoom</td>
				<td>
					<button onclick="zoomImageIn(1.00)">1.00</button>
					<button onclick="zoomImageIn(0.10)">0.10</button>
					<button onclick="zoomImageIn(0.01)">0.01</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="zoomGridOut(2.00)">-2.00</button>
					<button onclick="zoomGridOut(1.00)">-1.00</button>
					<button onclick="zoomGridOut(0.50)">-0.50</button>
					<button onclick="zoomGridOut(0.10)">-0.10</button>
				</td>
				<td>Grid Zoom</td>
				<td>
					<button onclick="zoomGridIn(2.00)">+2.00</button>
					<button onclick="zoomGridIn(1.00)">+1.00</button>
					<button onclick="zoomGridIn(0.50)">+0.50</button>
					<button onclick="zoomGridIn(0.10)">+0.10</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="spriteWidthSub(1.00)">-1.00</button>
				</td>
				<td>Grid X Width</td>
				<td>
					<button onclick="spriteWidthAdd(1.00)">+1.00</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="spriteHeightSub(1.00)">-1.00</button>
				</td>
				<td>Grid Y Height</td>
				<td>
					<button onclick="spriteHeightAdd(1.00)">+1.00</button>
				</td>
			</tr>
			<tr class="custom-height">
				<td colspan="3"></td>
			</tr>
		</tbody>
	</table>

	<script>
		// Get the canvas element
		var canvas = document.getElementById("spriteEditor");

		// Set the canvas dimensions
		canvas.width = 600;
		canvas.height = 600;

		// Create a new CanvasRenderingContext2D object
		var ctx = canvas.getContext("2d");

		let scaleFactor = 1.0; // Zoom factor

		// Define the pallet of colors
		//palletLetters
		var palletColors = ["#00000000", "#FF0000FF", "#FF8800FF", "#FFFF00FF",
			"#00FF00FF", "#00FFFFFF", "#0000FFFF", "#FF00FFFF"];

		function loadPalletLetters() {
			// Get the textarea element by its ID
			const textarea = document.getElementById('lettersID');

			// Access the content (value) of the textarea
			const content = textarea.value;
			console.log("Pallet Colors:", content);
		}
		function loadPalletColors() {
			// Get the textarea element by its ID
			const textarea = document.getElementById('palletID');

			// Access the content (value) of the textarea
			const content = textarea.value;
			console.log("Pallet Colors:", content);
		}
		function loadSprite() {
			// Get the textarea element by its ID
			const textarea = document.getElementById('spriteID');

			// Access the content (value) of the textarea
			const content = textarea.value;
			console.log("Sprite:", content);
		}

		// Define the width and height of each sprite
		let spriteSize = 30;

		const gridX = spriteSize / 2.0;
		const gridY = spriteSize * 2.5;

		let selectedColor = "#00000000";
		let selectedColorIndex = 0;
		let selectedCellX = 0;
		let selectedCellY = 0;

		let imageX = 0;
		let imageY = 100;

		let gridCellWidth = 10;
		let gridCellHeight = 10;
		let array = new Array(gridCellWidth);
		let arrayIndex = new Array(gridCellWidth);

		initArrays();

		const image = new Image();
		image.src = '8bit tiles.jpg';
		image.onload = function () {
			drawAll();
		};

		function initArrays() {
			// Create the array
			for (var i = 0; i < gridCellWidth; i++) {
				array[i] = new Array(gridCellHeight);
				arrayIndex[i] = new Array(gridCellHeight);
			}

			for (var x = 0; x < gridCellWidth; x++) {
				for (var y = 0; y < gridCellHeight; y++) {
					array[x][y] = "#00000000";
					arrayIndex[x][y] = 0;
				}
			}
		}

		function moveImageLeft(moveFactor) {
			imageX -= moveFactor;
			drawAll();
		}
		function moveImageRight(moveFactor) {
			imageX += moveFactor;
			drawAll();
		}

		function moveImageUp(moveFactor) {
			imageY -= moveFactor;
			drawAll();
		}
		function moveImageDown(moveFactor) {
			imageY += moveFactor;
			drawAll();
		}

		function zoomImageIn(zoomFactor) {
			scaleFactor += zoomFactor;
			if (scaleFactor >= 5.0) {
				scaleFactor = 5.0;
			}
			drawAll();
			console.log(scaleFactor);
		}
		function zoomImageOut(zoomFactor) {
			scaleFactor -= zoomFactor;
			if (scaleFactor <= 0.01) {
				scaleFactor = 0.01;
			}
			drawAll();
			console.log(scaleFactor);
		}

		function zoomGridIn(zoomFactor) {
			spriteSize += zoomFactor;
			drawAll();
		}
		function zoomGridOut(zoomFactor) {
			spriteSize -= zoomFactor;
			drawAll();
		}

		function spriteWidthAdd(width) {
			gridCellWidth += width;
			initArrays();
			drawAll();
		}
		function spriteWidthSub(width) {
			gridCellWidth -= width;
			if (gridCellWidth < 1) {
				gridCellWidth = 1;
			}
			initArrays();
			drawAll();
		}
		function spriteHeightAdd(height) {
			gridCellHeight += height;
			initArrays();
			drawAll();
		}
		function spriteHeightSub(height) {
			gridCellHeight -= height;
			if (gridCellHeight < 1) {
				gridCellHeight = 1;
			}
			initArrays();
			drawAll();
		}

		function drawAll() {
			// Clear the canvas and set background color to #333333
			ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
			ctx.fillStyle = '#333333'; // Set background color to dark gray
			ctx.fillRect(0, 0, canvas.width, canvas.height); // Fill the entire canvas

			ctx.save();
			ctx.scale(scaleFactor, scaleFactor);
			ctx.drawImage(image, imageX, imageY);
			ctx.restore();

			drawGrid();
			drawPallet();
			drawSelectedColor();
		}
		function drawGrid() {
			ctx.strokeStyle = "#000000";
			ctx.fillStyle = "#000000";

			// Start a new Path
			for (var x = 0; x < gridCellWidth + 1; x++) {
				ctx.beginPath();
				ctx.moveTo(x * spriteSize + gridX, gridY);
				ctx.lineTo(x * spriteSize + gridX, spriteSize * gridCellHeight + gridY);
				ctx.stroke();
			}

			for (var y = 0; y < gridCellHeight + 1; y++) {
				ctx.beginPath();
				ctx.moveTo(gridX, y * spriteSize + gridY);
				ctx.lineTo(spriteSize * gridCellWidth + gridX, y * spriteSize + gridY);
				ctx.stroke();
			}

			for (var x = 0; x < gridCellWidth; x++) {
				for (var y = 0; y < gridCellHeight; y++) {
					if (arrayIndex[x][y] === 0) {
						drawTransparent(x, y);
					} else {
						drawColor(x, y, array[x][y]);
					}
				}
			}
		}
		function drawColor(x, y, color) {
			// Draw a circle on the selected sprite
			ctx.beginPath();
			ctx.arc((spriteSize * x) + gridX + spriteSize / 2,
				(spriteSize * y) + gridY + spriteSize / 2,
				spriteSize / 4, 0, 2 * Math.PI);
			ctx.strokeStyle = color;
			ctx.fillStyle = color;
			ctx.stroke();
			ctx.fill();
		}
		function drawTransparent(x, y) {
			// Draw a circle on the selected sprite
			ctx.beginPath();
			ctx.arc((spriteSize * x) + gridX + spriteSize / 2,
				(spriteSize * y) + gridY + spriteSize / 2,
				spriteSize / 4, 0, 2 * Math.PI);
			ctx.strokeStyle = "#000000";
			ctx.fillStyle = "#FFFFFF80";
			ctx.stroke();
			ctx.fill();
		}
		function drawPallet() {
			ctx.clearRect(0, 0, canvas.width, spriteSize * 2); // Clear the canvas
			ctx.fillStyle = '#000000'; // Set background color to dark gray
			ctx.fillRect(0, 0, canvas.width, spriteSize * 2); // Fill the entire canvas

			for (var i = 0; i < palletColors.length; i++) {
				ctx.fillStyle = palletColors[i];
				ctx.fillRect(spriteSize * i, 0, spriteSize, spriteSize);
			}
		}
		function drawSelectedColor() {
			// Change the color of the selected sprite
			ctx.fillStyle = selectedColor;
			ctx.fillRect(0, spriteSize, spriteSize, spriteSize);
		}

		// Add an event listener to the canvas for clicks
		canvas.addEventListener("click", function (event) {
			// Get the coordinates of the click
			var x = event.gridX;
			var y = event.gridY;

			if (y > spriteSize) {
				selectedCellX = Math.floor((x - gridX) / spriteSize);
				selectedCellY = Math.floor((y - gridY) / spriteSize);

				if (selectedCellX < 0 || selectedCellX > gridCellWidth - 1 ||
					selectedCellY < 0 || selectedCellY > gridCellHeight - 1) {
					return;
				}

				// Set the array element
				arrayIndex[selectedCellX][selectedCellY] = selectedColorIndex;
				array[selectedCellX][selectedCellY] = selectedColor;
			} else {
				// Determine which sprite was clicked
				var clickedSprite = Math.floor(x / spriteSize);

				selectedColor = palletColors[clickedSprite];
				selectedColorIndex = clickedSprite;
			}
			drawAll();
		});

		window.onload = function () {
			loadPalletLetters();
			loadPalletColors();
			loadSprite();
		};
	</script>


	<br />
	<label>Image (abc.png)</label>
	<br />

	<label>Sprite array</label>
	<br />
	<textarea id="lettersID" name="letter" rows="5" cols="50">letters</textarea>

	<label>Pallet ('0' should always Transparent)</label>
	<br />
	<textarea id="palletID" name="pallet" rows="5" cols="50">pallet</textarea>
	<br />
	<label>Sprite array</label>
	<br />
	<textarea id="spriteID" name="sprite" rows="5" cols="50">sprite</textarea>

</body>

</html>